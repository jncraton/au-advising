#!/usr/bin/env python3
import os
import subprocess
import sys


def find_pdfs(root):
    for dirpath, dirs, files in os.walk(root):
        for f in files:
            if f.lower().endswith(".pdf"):
                yield os.path.join(dirpath, f)


def has_md(pdf_path):
    base, _ = os.path.splitext(pdf_path)
    return os.path.exists(base + ".md")


def main():
    root = os.getcwd()
    docling_path = os.path.join(root, "docling")
    for pdf in find_pdfs(root):
        if not has_md(pdf):
            print("Generating markdown for", pdf)
            try:
                subprocess.run([docling_path, pdf_path], check=True)
            except subprocess.CalledProcessError as e:
                print(f"docling failed for {pdf}: {e}", file=sys.stderr)
            except FileNotFoundError:
                print(f"docling script not found at {docling_path}", file=sys.stderr)
                sys.exit(2)
        else:
          print("Found markdown for", pdf)


if __name__ == "__main__":
    main()
